## kad-java


### kad论文梳理

宏观抽象结构是一棵分布式的二叉树，每片叶子是DHT网络中的一个节点
树的组织形式是以节点ID的二进制表示来构建的，每个节点存储这颗二叉树的一部分,
所有节点的信息叠加整合起来就是这一整颗二叉树

#### 注:词语解释
+ *散列算法*:也就是hash算法,一般选择sha1(160位，所以二叉树的深度也是160) 也可以是其他的hash算法
+ *本文中的二叉树*: 一颗根据节点ID位数和二进制信息构建的树行结构
+ *距离*:这里是指逻辑距离,并不是物理上的距离，而是两个节点ID之间的异或距离，相应的节点的远近关系说的就是节点ID
之间异或出来的值的大小
+ *k桶*:一个table 横向代表当前深度的子树中离自己最近(异或距离)的n个节点,竖向代表，树的深度(一般根据选择的散列算法决定)

#### 1.node结构关键信息

<table>
  <tr>
    <th>字段</td>
    <th>字段解释</td>
  </tr>
  <tr>
        <td>nodeId</td>
        <td>节点ID</td>
  </tr>
  <tr>
        <td>ip,port</td>
        <td>ip地址和端口信息</td>
    </tr>
  <tr>
        <td>data(map<key,value>)</td>
        <td>节点存储的数据</td>
  </tr>
  <tr>
        <td>k-bucket</td>
        <td>k桶(BitTorrent的实现中取值为8)</td>
  </tr>
</table>

#### 2.node的四个操作
  + *PING*: 探测一个节点是否在线
  + *STORE*: 令对方储存一份数据
  + *FIND NODE*: 根据节点ID查找一个节点
  + *FIND VALUE*: 根据键查找一个值(数据)

#### 3.节点加入与退出

  当只有一个节点时,这个节点没有可加入的网络，自己就是整个DHT网络<br/>
  
  当一个新节点想要加入网络时，需要找到一个已在网络中的节点，借助它对自己的节点ID进行一次常规查询
  <br/>
  假设想要加入网络的节点是A,已经在网络中存在的节点是B
  流程为<br/>
  1.节点A调用节点B的findNode操作 传给节点B自己的ID<br/>
  2.节点B算出自己与传入ID的距离(异或距离)d,找到对应的k桶，从这个k同种选取a(BitTorrent的实现中取值为3)个节点
  
  
